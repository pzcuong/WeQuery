doctype html
head
    title Bootstrap Example
    meta(charset='utf-8')
    meta(name='viewport' content='width=device-width, initial-scale=1')
    link(rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css')
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js')
    script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js')
    link(rel='stylesheet' href='/public/source/styleNav.css')

    nav
        div
            i(class='fa fa-bars')
        ul
            li
                a(href="#") Trang chủ
            li
                a(href="#") Giới thiệu
            li
                a(href="/user/TestSQL") Câu hỏi
            li
                a(href="/user/profile") user
            li
                a(href="/user/lichsu") Lịch sử truy vấn
body
    .container(style='color:green')
        h1 Thêm Testcase cho câu hỏi

    .container
        label Thông Tin Câu Hỏi #{message.MaCH}: #{message.TieuDe}
        h5(style="white-space: pre-wrap; font-size: 20px") #{message.NoiDung}

        form#formElem(action='/' method='POST')
            .form-group
                label(for='SQLQuery') Lược đồ quan hệ
                
                - var count = 0;
                
                each schema in schemas 
                    img(src='/public/image/schema_'+ schema +'.png' alt='' id="img_schema_"+ count++)

            .form-group
                label(for='SQLQuery') Lệnh SQL
                textarea.form-control(name='SQLQuery' placeholder='Nhập lệnh SQL tại đây...' rows='8' cols='50' required='required')
            .container
                button.btn.btn-success(onclick='Submit()' type='button') Lưu kết quả TestCase
            .form-group
                label(for='SQLQuery' style='margin-top: 10px;') Kết quả truy vấn
                p#encoded(style='overflow-y: auto; overflow-x: hidden; height: 300px; color: red')

script.
    async function Submit() {
        document.querySelector('#encoded').innerHTML = "Đang gửi yêu cầu, vui lòng đợi!";
        var form = document.querySelector("#formElem");
        data = {
            SQLQuery : form.querySelector('textarea[name="SQLQuery"]').value,
        }

        let url = window.location.href;

        let response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
            json: true
        })
        let text = await response.json();
        console.log(text)
        if(text.alert)
            alert(text.alert)
        document.querySelector("#encoded").innerHTML = JSON.stringify(text.result);
    };


script.
    window.onload = async () => {
        var widthScreen = window.screen.width;
        var schema = document.querySelectorAll(`[id^="img_schema_"]`);
        
        for (var i = 0; i < schema.length; i++) {
            var img = document.getElementById('img_schema_' + i).offsetWidth;
            if (img > widthScreen) 
                document.getElementById('img_schema_' + i).style.width = "100%";
            else 
                document.getElementById('img_schema_' + i).style.width = "auto";
        }
    }